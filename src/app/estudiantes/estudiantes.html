<!-- src/app/estudiantes/estudiantes.html -->
<div class="estudiantes-contenedor">
  <!-- Mensajes de error -->
  <div *ngIf="error" class="form-group error-message">
    {{ error }}
  </div>
  
  <!-- Modal de éxito -->
  <div *ngIf="showSuccessMessage" class="modal-success">
    <div class="modal-content">
      <h3>Estudiante creado exitosamente</h3>
      <p><strong>Usuario:</strong> {{ credencialesEstudiante.username }}</p>
      <p><strong>Correo:</strong> {{ credencialesEstudiante.correo }}</p>
      <p><strong>Contraseña temporal:</strong> {{ credencialesEstudiante.password }}</p>
      <button type="button" (click)="showSuccessMessage = false">Cerrar</button>
    </div>
  </div>

  <!-- Modal de registro -->
  <div *ngIf="showModal" class="modal-overlay" (click)="cerrarModalRegistro()">
    <div class="modal-registro" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Registrar Nuevo Estudiante</h3>
        <button class="close-button" (click)="cerrarModalRegistro()">×</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onSubmitNewStudent()" #studentForm="ngForm">
          <div class="form-group">
            <label for="nombre">Nombre *</label>
            <input type="text" id="nombre" [(ngModel)]="newStudent.nombre" name="nombre" required>
          </div>
          <div class="form-group">
            <label for="apellidos">Apellidos *</label>
            <input type="text" id="apellidos" [(ngModel)]="newStudent.apellidos" name="apellidos" required>
          </div>
          <div class="form-group">
            <label for="correo">Correo Electrónico *</label>
            <input type="email" id="correo" [(ngModel)]="newStudent.correo" name="correo" required>
          </div>
          <div class="form-group">
            <label for="role">Rol</label>
            <select id="role" [(ngModel)]="newStudent.role" name="role">
              <option value="estudiante">Estudiante</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
          <div class="form-group">
            <label for="estado">Estado</label>
            <select id="estado" [(ngModel)]="newStudent.estadoId" name="estadoId">
              <option [ngValue]="undefined">Seleccione estado</option>
              <option *ngFor="let estado of estadosDisponibles" [value]="estado.id">
                {{ estado.nombre }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="carrera">Carrera</label>
            <select id="carrera" [(ngModel)]="newStudent.carreraId" name="carreraId">
              <option [ngValue]="undefined">Seleccione carrera</option>
              <option *ngFor="let carrera of carrerasDisponibles" [value]="carrera.id">
                {{ carrera.nombre }}
              </option>
            </select>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primario" [disabled]="loading">
              Registrar Estudiante
            </button>
            <button type="button" class="btn-secundario" (click)="cerrarModalRegistro()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Overlay de carga -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <span class="kpi-icon">👨‍🎓</span>
      <h2>{{ totalEstudiantes }}</h2>
      <p>Total Estudiantes</p>
    </div>
    <div class="kpi-card">
      <span class="kpi-icon">✅</span>
      <h2>{{ estudiantesActivos }}</h2>
      <p>Estudiantes Activos</p>
    </div>
    <div class="kpi-card">
      <span class="kpi-icon">🛡️</span>
      <h2>{{ administradores }}</h2>
      <p>Administradores</p>
    </div>
  </div>

  <!-- Botón de nuevo estudiante -->
  <div class="boton-nuevo">
    <button class="btn-nuevo" (click)="abrirModalRegistro()">
      <span class="icono">+</span>
      Nuevo Estudiante
    </button>
  </div>

  <!-- Filtros de búsqueda -->
  <div class="search-filters">
    <input type="text" class="search-input" placeholder="Buscar..." [(ngModel)]="searchTerm" (input)="filtrarEstudiantes()">
    <select class="filter-select" [(ngModel)]="filtroEstado" (change)="filtrarEstudiantes()">
      <option value="">Todos los estados</option>
      <option *ngFor="let estado of estadosDisponibles" [value]="estado.id">
        {{ estado.nombre }}
      </option>
    </select>
    <select class="filter-select" [(ngModel)]="filtroCarrera" (change)="filtrarEstudiantes()">
      <option value="">Todas las carreras</option>
      <option *ngFor="let carrera of carrerasDisponibles" [value]="carrera.id">
        {{ carrera.nombre }}
      </option>
    </select>
    <select class="filter-select" [(ngModel)]="filtroRol" (change)="filtrarEstudiantes()">
      <option value="">Todos los roles</option>
      <option value="estudiante">Estudiante</option>
      <option value="admin">Administrador</option>
    </select>
  </div>

  <!-- Tabla de estudiantes -->
  <div class="table-responsive">
    <table class="table-modern">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellidos</th>
          <th>Usuario</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Carrera</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let estudiante of filteredEstudiantes">
          <td>{{ estudiante.nombre }}</td>
          <td>{{ estudiante.apellidos }}</td>
          <td>{{ estudiante.username || '-' }}</td>
          <td>{{ estudiante.correo }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'badge-admin': estudiante.role === 'admin'
            }">{{ estudiante.role }}</span>
          </td>
          <td>{{ getEstadoNombre(estudiante.estadoId) }}</td>
          <td>{{ getCarreraNombre(estudiante.carreraId) }}</td>
          <td class="actions-cell">
            <button (click)="deleteEstudiante(estudiante.id)" [disabled]="loading">
              🗑️
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredEstudiantes.length === 0">
          <td colspan="8" class="no-results">
            No se encontraron estudiantes con los filtros aplicados
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>