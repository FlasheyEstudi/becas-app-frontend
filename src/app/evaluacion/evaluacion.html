<!-- src/app/evaluacion/evaluacion.html -->
<div class="evaluacion-contenedor">
    <h2 class="titulo-principal">Evaluaciones</h2>
    <!-- Mensaje de error si existe -->
    <div *ngIf="error" class="alerta">{{ error }}</div>
    <!-- Indicador de carga -->
    <div *ngIf="loading" class="loading">
        Cargando...
    </div>
    <!-- Buscador -->
    <div class="search-container">
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()"
            placeholder="Buscar por ID de solicitud o evaluador..." class="search-input" />
    </div>
    <!-- Formulario para añadir evaluación -->
    <div class="form-container">
        <h3 class="subtitulo">Añadir Nueva Evaluación</h3>
        <form (ngSubmit)="onSubmitNewEvaluacion()" #evaluacionForm="ngForm">
            <div class="form-group">
                <label for="solicitudId">ID Solicitud:</label>
                <input type="number" id="solicitudId" name="solicitudId" [(ngModel)]="newEvaluacion.solicitudId"
                    placeholder="ID de la solicitud" required min="1" />
            </div>
            <div class="form-group">
                <label for="evaluadorId">ID Evaluador:</label>
                <input type="number" id="evaluadorId" name="evaluadorId" [(ngModel)]="newEvaluacion.evaluadorId"
                    placeholder="ID del evaluador" required min="1" />
            </div>
            <div class="form-group">
                <label for="puntuacionTotal">Puntuación Total:</label>
                <input type="number" id="puntuacionTotal" name="puntuacionTotal"
                    [(ngModel)]="newEvaluacion.puntuacionTotal" placeholder="Puntuación total (0-100)" required min="0"
                    max="100" />
            </div>
            <div class="form-group">
                <label for="recomendacion">Recomendación:</label>
                <select id="recomendacion" name="recomendacion" [(ngModel)]="newEvaluacion.recomendacion">
                    <option value="pendiente">Pendiente</option>
                    <option value="aprobado">Aprobado</option>
                    <option value="rechazado">Rechazado</option>
                </select>
            </div>
            <div class="form-group">
                <label for="comentarios">Comentarios:</label>
                <textarea id="comentarios" name="comentarios" [(ngModel)]="newEvaluacion.comentarios"
                    placeholder="Comentarios de la evaluación" class="form-textarea"></textarea>
            </div>
            <div class="form-actions">
                <button type="submit" [disabled]="loading" class="btn-primario">
                    Añadir Evaluación
                </button>
                <button type="button" (click)="onCancel()" class="btn-secundario">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
    <!-- Botón para recargar -->
    <button class="btn btn-primario mb-3" (click)="cargarEvaluaciones()" [disabled]="loading">
        Recargar Lista
    </button>
    <!-- Tabla de evaluaciones -->
    <table class="tabla" *ngIf="!loading && filteredEvaluaciones.length > 0">
        <thead>
            <tr>
                <th>ID</th>
                <th>Solicitud ID</th>
                <th>Evaluador ID</th>
                <th>Puntuación</th>
                <th>Recomendación</th>
                <th>Fecha Evaluación</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let evaluacion of filteredEvaluaciones">
                <td>{{ evaluacion.id }}</td>
                <td>{{ evaluacion.solicitudId }}</td>
                <td>{{ evaluacion.evaluadorId }}</td>
                <td>{{ evaluacion.puntuacionTotal }}</td>
                <td>{{ evaluacion.recomendacion || 'Pendiente' }}</td>
                <td>{{ evaluacion.fechaEvaluacion ? (evaluacion.fechaEvaluacion | date:'dd/MM/yyyy') : 'N/A' }}</td>
                <td>
                    <button (click)="deleteEvaluacion(evaluacion.id)" class="btn-danger btn-sm">
                        Eliminar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <!-- Mensaje si no hay evaluaciones -->
    <p *ngIf="filteredEvaluaciones.length === 0 && !loading && !error" class="texto-centro">
        No hay evaluaciones que coincidan con la búsqueda.
    </p>
    <!-- Mensaje si no hay evaluaciones en la base de datos -->
    <p *ngIf="evaluaciones.length === 0 && !loading && !error" class="texto-centro">
        No hay evaluaciones registradas en el sistema.
    </p>
</div>